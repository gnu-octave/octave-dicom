MKOCTFILE ?= mkoctfile -Wall
OCTAVE ?= octave

GDCM_CPPFLAGS = @GDCM_CXXFLAGS@
GDCM_LIBS = @GDCM_LIBS@

need_dict = dicominfo.oct dicomwrite.oct dicomlookup.oct

test_files = dicominfo.cpp dicomdict.cpp dicomread.cpp dicomlookup.cpp

all: $(need_dict) dicomdict.oct dicomread.oct _gendicomdict.oct

%.o: %.cpp
	$(MKOCTFILE) $(GDCM_CPPFLAGS) -c $<

$(need_dict): %.oct: %.cpp dicomdict.o
	$(MKOCTFILE) $(GDCM_CPPFLAGS) $(GDCM_LIBS) $^

%.oct: %.cpp
	$(MKOCTFILE) $(GDCM_CPPFLAGS) $(GDCM_LIBS) $<

clean:
	rm -f *.o *.oct *~

test:
	for file in $(test_files); do \
		$(OCTAVE) -q --eval "test $$file"; \
	done
